/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'mlm' at '6/6/16 9:03 AM' with Gradle 2.13
 *
 *  03/23/2023 mlm - updated to use gradle 7.2 from 2.4.4
 *               groovy-all 3.0.6 -> 4.0.10
 *               commons-csv-1.8   -> 1.10.0
 *               jakarta.mail-1.6.5 -> 2.0.1
 * This generated file contains a sample Groovy project to get you started.
 * For more details take a look at the Groovy Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/2.13/userguide/tutorial_groovy_projects.html
 */
plugins {
  //id 'org.hidetake.ssh' version '2.11.2'  << JDK 11+
  id 'org.hidetake.ssh' version '2.2.0'
}

// Apply the groovy plugin to add support for Groovy
apply plugin: 'groovy'

repositories {
    mavenLocal()  // so we can find oracle jdbc from local repository
    mavenCentral()
}
dependencies {
    // https://mvnrepository.com/artifact/org.apache.groovy/groovy-all
    implementation group: 'org.apache.groovy', name: 'groovy-all', version: '4.0.10'
    implementation 'com.oracle:ojdbc8:19.7.0.0'
    implementation group: 'com.sun.mail', name: 'jakarta.mail', version: '2.0.1'
    implementation group: 'jakarta.activation', name: 'jakarta.activation-api', version: '2.1.1'
    implementation group: 'org.eclipse.angus', name: 'angus-activation', version: '2.0.0'
    implementation 'org.apache.commons:commons-csv:1.10.0'
}

remotes {
  zebra {
    host = 'zebra1.uvm.edu'
    user = 'mlm'
    identity = file('/Users/mlm/.ssh/id_dsa')
  }
}
task deploy {
  doLast {
  ssh.run {
    session(remotes.zebra) {
      put 'build/libs/scripttool.jar', './scripttool/lib4/.'
      //execute 'sudo service tomcat restart'
    }
  }
  }
}


task setseed {
  // Task to Set the Banner Security Seed numbers for this installation
  // Syntax:  gradle -q setseed
  // Will prompt for seed1 and seed3.
  // Run once.  After that edit the class file directly.
  doLast{
  String fname =  "$projectDir/src/main/groovy/edu/uvm/banner/security/BannerSeeds.groovy"
  File f = new File( fname )

  if (!f.exists()) {
    String seed1 = System.console().readLine("Enter seed1: ")
    String seed3 = System.console().readLine("Enter seed3: ")
    String code = """package edu.uvm.banner.security;
class BannerSeeds {
  protected static Integer seed1 = $seed1;
  protected static Integer seed3 = $seed3;
}
"""
    // Doit...
    f.write(code)
  } else {
    println "File already exists. See $fname"
  }
}
}
